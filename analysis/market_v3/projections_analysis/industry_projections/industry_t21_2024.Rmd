---
title: "SHRS Market Analysis — Industry Employment by Sector (2024 Vintage)"
subtitle: "BLS Employment Projections Table 2.1 · 2024–2034 Cycle"
author: "SHRS MQE Capstone Team"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo    = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 10,
  fig.height = 6
)
```

# 0 — Setup

```{r packages}
library(tidyverse)
library(scales)
library(knitr)
library(kableExtra)
```

```{r config}
# ── SOC crosswalk (self-contained) ──
soc_crosswalk <- tribble(
  ~shrs_program, ~shrs_dept, ~soc_code,  ~occupation_title,
  "SLP",         "CSD",      "29-1127",  "Speech-Language Pathologists",
  "AuD",         "CSD",      "29-1181",  "Audiologists",
  "HIM",         "HIM",      "29-9021",  "Health Information Technologists and Medical Registrars",
  "OTD",         "RST",      "29-1122",  "Occupational Therapists",
  "DPT",         "RST",      "29-1123",  "Physical Therapists",
  "PAS",         "PAS",      "29-1071",  "Physician Assistants",
  "AT",          "SMN",      "29-9091",  "Athletic Trainers",
  "DN",          "SMN",      "29-1031",  "Dietitians and Nutritionists",
  "SS",          "SMN",      "29-1128",  "Exercise Physiologists"
)

# ── File path (edit for your machine) ──
DATA_PATH <- "/Users/gpps/Documents/SHRS_Analysis/market_analysis/v3data/projections_csv/industry_csv/2024/2024_industry - Table 2.1.csv"

VINTAGE <- 2024
CYCLE   <- "2024-2034"
```

```{r helpers}
clean_num <- function(x) {
  x <- str_remove_all(x, ",")
  x <- str_replace_all(x, "—|–|-", NA_character_)
  as.numeric(x)
}
```

---

# 1 — Load & Clean Data

Table 2.1 provides a **sector-level overview** of employment by major industry.
This is the broadest cut — roughly 20 rows covering every sector of the economy.
The healthcare & social assistance sector (NAICS 62) is the primary employer for
all 9 SHRS programs.

**Column layout (2024 vintage, 14 columns):**

| Pos | Content |
|-----|---------|
| 1 | Industry sector name |
| 2 | 2022 NAICS code |
| 3 | Employment, 2014 (thousands) |
| 4 | Employment, 2024 (thousands) |
| 5 | Employment, 2034 (thousands) |
| 6 | Employment change, numeric, 2014–24 |
| 7 | Employment change, numeric, 2024–34 |
| 8 | Employment change, percent, 2014–24 |
| 9 | Employment change, percent, 2024–34 |
| 10 | Percent distribution, 2014 |
| 11 | Percent distribution, 2024 |
| 12 | Percent distribution, 2034 |
| 13 | Compound annual rate of change, 2014–24 |
| 14 | Compound annual rate of change, 2024–34 |

```{r load-data}
raw <- read_csv(DATA_PATH, col_types = cols(.default = "c"), col_names = FALSE)

# Assign column names by position
colnames(raw) <- c(
  "industry_sector", "naics",
  "emp_hist", "emp_base", "emp_proj",
  "emp_change_hist", "emp_change_proj",
  "emp_pct_hist", "emp_pct_proj",
  "pct_dist_hist", "pct_dist_base", "pct_dist_proj",
  "cagr_hist", "cagr_proj"
)

# Drop the header row (row 1 is the original header)
raw <- raw[-1, ]

# Clean footnote markers from industry names
raw <- raw %>%
  mutate(industry_sector = str_remove_all(industry_sector, "\\(\\d+\\)|\\[\\d+\\]") %>%
           str_trim())

# Convert numeric columns
df <- raw %>%
  mutate(across(-c(industry_sector, naics), clean_num))

cat("Loaded", nrow(df), "industry sectors for", CYCLE, "cycle\n")
```

```{r preview}
df %>%
  select(industry_sector, naics, emp_base, emp_proj, emp_pct_proj, cagr_proj) %>%
  head(10) %>%
  kable(digits = 1, format.args = list(big.mark = ","),
        caption = "Table 2.1 Preview — First 10 Rows") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

---

# 2 — Total Economy Benchmark

```{r benchmarks}
# Row 1 = Total employment
total_row <- df %>% slice(1)
total_emp_base     <- total_row$emp_base
total_emp_proj     <- total_row$emp_proj
total_change_proj  <- total_row$emp_change_proj
total_pct_proj     <- total_row$emp_pct_proj
total_cagr_proj    <- total_row$cagr_proj

cat("Total Economy (", CYCLE, "):\n")
cat("  Base employment:      ", comma(total_emp_base * 1000), "\n")
cat("  Projected employment: ", comma(total_emp_proj * 1000), "\n")
cat("  Projected change:     ", comma(total_change_proj * 1000),
    " (", total_pct_proj, "%)\n")
cat("  CAGR:                 ", total_cagr_proj, "%\n")
```

---

# 3 — Sector Employment Overview

## 3.1 Employment by Sector (Current)

```{r sector-bar, fig.height=8}
# Filter to actual sector rows (not totals or sub-totals)
sectors <- df %>%
  filter(!is.na(emp_base),
         !str_detect(industry_sector, "^Total|^Self-employed|^Total wage")) %>%
  # Clean leading whitespace that denotes hierarchy

  mutate(sector_clean = str_trim(industry_sector))

# Flag healthcare
sectors <- sectors %>%
  mutate(is_healthcare = str_detect(sector_clean,
    regex("health care|healthcare|social assistance", ignore_case = TRUE)))

sectors %>%
  ggplot(aes(x = reorder(sector_clean, emp_base), y = emp_base,
             fill = is_healthcare)) +
  geom_col(width = 0.7) +
  geom_text(aes(label = comma(emp_base, accuracy = 0.1)),
            hjust = -0.05, size = 3.2) +
  coord_flip() +
  scale_fill_manual(values = c("FALSE" = "#b0c4de", "TRUE" = "#d7191c"),
                    labels = c("Other Sectors", "Healthcare & Social Assistance"),
                    name = NULL) +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.2))) +
  labs(
    title = paste0("Employment by Industry Sector (", VINTAGE, ", thousands)"),
    subtitle = paste0("BLS Table 2.1 — ", CYCLE, " projections cycle"),
    x = NULL, y = "Employment (thousands)"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```

## 3.2 Projected Growth Rate by Sector

```{r sector-growth, fig.height=8}
sectors %>%
  filter(!is.na(emp_pct_proj)) %>%
  ggplot(aes(x = reorder(sector_clean, emp_pct_proj), y = emp_pct_proj,
             fill = is_healthcare)) +
  geom_col(width = 0.7) +
  geom_hline(yintercept = total_pct_proj, linetype = "dashed",
             color = "gray40", linewidth = 0.7) +
  annotate("text", x = 2, y = total_pct_proj + 0.4,
           label = paste0("All industries: ", total_pct_proj, "%"),
           hjust = 0, size = 3.5, color = "gray40") +
  geom_text(aes(label = paste0(emp_pct_proj, "%")),
            hjust = ifelse(sectors$emp_pct_proj[!is.na(sectors$emp_pct_proj)] >= 0,
                           -0.1, 1.1),
            size = 3.2) +
  coord_flip() +
  scale_fill_manual(values = c("FALSE" = "#b0c4de", "TRUE" = "#d7191c"),
                    labels = c("Other Sectors", "Healthcare & Social Assistance"),
                    name = NULL) +
  scale_y_continuous(expand = expansion(mult = c(0.1, 0.2))) +
  labs(
    title = paste0("Projected Employment Growth by Sector (", CYCLE, ")"),
    subtitle = "Dashed line = all-industry benchmark",
    x = NULL, y = "Projected Growth (%)"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```

## 3.3 CAGR Comparison

```{r sector-cagr, fig.height=8}
sectors %>%
  filter(!is.na(cagr_proj)) %>%
  ggplot(aes(x = reorder(sector_clean, cagr_proj), y = cagr_proj,
             fill = is_healthcare)) +
  geom_col(width = 0.7) +
  geom_hline(yintercept = total_cagr_proj, linetype = "dashed",
             color = "gray40", linewidth = 0.7) +
  coord_flip() +
  scale_fill_manual(values = c("FALSE" = "#b0c4de", "TRUE" = "#d7191c"),
                    labels = c("Other Sectors", "Healthcare & Social Assistance"),
                    name = NULL) +
  labs(
    title = paste0("Compound Annual Growth Rate by Sector (", CYCLE, ")"),
    subtitle = "Dashed line = all-industry CAGR",
    x = NULL, y = "CAGR (%)"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```

---

# 4 — Healthcare Sector Deep-Dive

```{r healthcare-extract}
# Locate the healthcare row
hc_row <- sectors %>%
  filter(is_healthcare) %>%
  slice(1)

hc_emp_base    <- hc_row$emp_base
hc_emp_proj    <- hc_row$emp_proj
hc_pct_proj    <- hc_row$emp_pct_proj
hc_cagr_proj   <- hc_row$cagr_proj
hc_pct_dist_base <- hc_row$pct_dist_base
hc_pct_dist_proj <- hc_row$pct_dist_proj

cat("Healthcare & Social Assistance (", CYCLE, "):\n")
cat("  Base employment:       ", comma(hc_emp_base * 1000), "\n")
cat("  Projected employment:  ", comma(hc_emp_proj * 1000), "\n")
cat("  Projected growth:      ", hc_pct_proj, "%\n")
cat("  CAGR:                  ", hc_cagr_proj, "%\n")
cat("  Share of economy (base):", hc_pct_dist_base, "%\n")
cat("  Share of economy (proj):", hc_pct_dist_proj, "%\n")
```

## 4.1 Healthcare vs Economy Growth

```{r hc-vs-economy}
comparison <- tribble(
  ~metric,                          ~healthcare, ~all_industries,
  "Projected Growth (%)",           hc_pct_proj,  total_pct_proj,
  "CAGR (%)",                       hc_cagr_proj, total_cagr_proj
)

comparison %>%
  pivot_longer(-metric, names_to = "category", values_to = "value") %>%
  mutate(category = if_else(category == "healthcare",
                            "Healthcare & Social Assistance", "All Industries")) %>%
  ggplot(aes(x = metric, y = value, fill = category)) +
  geom_col(position = "dodge", width = 0.6) +
  geom_text(aes(label = paste0(value, "%")),
            position = position_dodge(width = 0.6), vjust = -0.5, size = 4) +
  scale_fill_manual(values = c("Healthcare & Social Assistance" = "#d7191c",
                                "All Industries" = "#b0c4de")) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.25))) +
  labs(
    title = paste0("Healthcare vs Total Economy — Growth Comparison (", CYCLE, ")"),
    x = NULL, y = "Rate (%)", fill = NULL
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "bottom")
```

## 4.2 Healthcare's Growing Share of the Economy

```{r hc-share}
hc_share_hist <- hc_row$pct_dist_hist

share_df <- tibble(
  year = c(VINTAGE - 10, VINTAGE, VINTAGE + 10),
  share = c(hc_share_hist, hc_pct_dist_base, hc_pct_dist_proj)
) %>%
  filter(!is.na(share))

share_df %>%
  ggplot(aes(x = year, y = share)) +
  geom_line(linewidth = 1.2, color = "#d7191c") +
  geom_point(size = 4, color = "#d7191c") +
  geom_text(aes(label = paste0(share, "%")), vjust = -1.2, size = 4.5) +
  scale_y_continuous(limits = c(0, max(share_df$share, na.rm = TRUE) + 3)) +
  labs(
    title = "Healthcare & Social Assistance: Growing Share of Total Employment",
    subtitle = paste0("Percent of total employment, ", min(share_df$year),
                      "–", max(share_df$year)),
    x = NULL, y = "% of Total Employment"
  ) +
  theme_minimal(base_size = 13)
```

---

# 5 — Sector Ranking & Healthcare Context for SHRS

## 5.1 Sector Rankings

```{r sector-rankings}
rankings <- sectors %>%
  filter(!is.na(emp_pct_proj)) %>%
  mutate(
    rank_growth = rank(-emp_pct_proj),
    rank_size   = rank(-emp_base),
    rank_cagr   = rank(-cagr_proj)
  )

hc_rankings <- rankings %>% filter(is_healthcare)

cat("Healthcare & Social Assistance Rankings:\n")
cat("  Growth rate rank:  ", hc_rankings$rank_growth, "of", nrow(rankings), "\n")
cat("  Employment size rank:", hc_rankings$rank_size, "of", nrow(rankings), "\n")
cat("  CAGR rank:         ", hc_rankings$rank_cagr, "of", nrow(rankings), "\n")
```

## 5.2 Full Sector Table

```{r full-sector-table}
rankings %>%
  arrange(rank_growth) %>%
  select(
    Sector        = sector_clean,
    `Emp Base (K)` = emp_base,
    `Emp Proj (K)` = emp_proj,
    `Growth (%)`   = emp_pct_proj,
    `CAGR (%)`     = cagr_proj,
    `Share Base (%)` = pct_dist_base,
    `Growth Rank`  = rank_growth
  ) %>%
  kable(digits = 1, format.args = list(big.mark = ","),
        caption = paste0("Industry Sectors Ranked by Projected Growth (", CYCLE, ")")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(which(rankings %>% arrange(rank_growth) %>% pull(is_healthcare)),
           bold = TRUE, background = "#ffe0e0")
```

---

# 6 — Industry Context Scorecard for SHRS

This scorecard assesses how favorable the **industry environment** is for SHRS
programs, based on the healthcare sector's position in the broader economy.

```{r scorecard}
# Scoring dimensions (each 0–100)

# 1. Growth premium: how much faster is healthcare growing than total economy?
growth_ratio <- hc_pct_proj / total_pct_proj
growth_score <- case_when(
  growth_ratio >= 3.0 ~ 100,
  growth_ratio >= 2.5 ~ 90,
  growth_ratio >= 2.0 ~ 80,
  growth_ratio >= 1.5 ~ 70,
  growth_ratio >= 1.0 ~ 60,
  growth_ratio >= 0.5 ~ 40,
  TRUE                ~ 20
)

# 2. Market size: healthcare share of total employment
size_score <- case_when(
  hc_pct_dist_base >= 15 ~ 100,
  hc_pct_dist_base >= 12 ~ 85,
  hc_pct_dist_base >= 10 ~ 70,
  hc_pct_dist_base >= 8  ~ 55,
  hc_pct_dist_base >= 5  ~ 40,
  TRUE                    ~ 20
)

# 3. Share trajectory: is healthcare's share of the economy growing?
share_change <- hc_pct_dist_proj - hc_pct_dist_base
trajectory_score <- case_when(
  share_change >= 1.0 ~ 100,
  share_change >= 0.5 ~ 80,
  share_change >= 0.0 ~ 60,
  share_change >= -0.5 ~ 40,
  TRUE                  ~ 20
)

# 4. CAGR premium
cagr_ratio <- hc_cagr_proj / total_cagr_proj
cagr_score <- case_when(
  cagr_ratio >= 3.0 ~ 100,
  cagr_ratio >= 2.5 ~ 90,
  cagr_ratio >= 2.0 ~ 80,
  cagr_ratio >= 1.5 ~ 70,
  cagr_ratio >= 1.0 ~ 60,
  cagr_ratio >= 0.5 ~ 40,
  TRUE               ~ 20
)

# Composite
composite_score <- round(mean(c(growth_score, size_score,
                                 trajectory_score, cagr_score)), 0)
signal <- case_when(
  composite_score >= 70 ~ "Green",
  composite_score >= 50 ~ "Yellow",
  TRUE                  ~ "Red"
)

scorecard_df <- tibble(
  Dimension = c("Growth Premium", "Market Size", "Share Trajectory",
                "CAGR Premium", "COMPOSITE"),
  Score     = c(growth_score, size_score, trajectory_score,
                cagr_score, composite_score),
  Signal    = c(
    if_else(growth_score >= 70, "Green", if_else(growth_score >= 50, "Yellow", "Red")),
    if_else(size_score >= 70, "Green", if_else(size_score >= 50, "Yellow", "Red")),
    if_else(trajectory_score >= 70, "Green", if_else(trajectory_score >= 50, "Yellow", "Red")),
    if_else(cagr_score >= 70, "Green", if_else(cagr_score >= 50, "Yellow", "Red")),
    signal
  ),
  Detail    = c(
    paste0("HC growth ", hc_pct_proj, "% vs ", total_pct_proj, "% all-industry (",
           round(growth_ratio, 2), "x)"),
    paste0("HC = ", hc_pct_dist_base, "% of total employment"),
    paste0("HC share moves ", hc_pct_dist_base, "% → ", hc_pct_dist_proj,
           "% (+", round(share_change, 1), " pp)"),
    paste0("HC CAGR ", hc_cagr_proj, "% vs ", total_cagr_proj, "% all-industry (",
           round(cagr_ratio, 2), "x)"),
    paste0("Average of 4 dimensions")
  )
)
```

```{r scorecard-table}
scorecard_df %>%
  kable(caption = paste0("Industry Context Scorecard — Healthcare Sector (",
                          CYCLE, ")")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(which(scorecard_df$Signal == "Green"),
           background = "#d4edda", color = "#155724") %>%
  row_spec(which(scorecard_df$Signal == "Yellow"),
           background = "#fff3cd", color = "#856404") %>%
  row_spec(which(scorecard_df$Signal == "Red"),
           background = "#f8d7da", color = "#721c24") %>%
  row_spec(5, bold = TRUE)
```

```{r scorecard-viz}
scorecard_df %>%
  filter(Dimension != "COMPOSITE") %>%
  ggplot(aes(x = reorder(Dimension, Score), y = Score,
             fill = Signal)) +
  geom_col(width = 0.6) +
  geom_text(aes(label = Score), hjust = -0.2, size = 4.5, fontface = "bold") +
  geom_hline(yintercept = 70, linetype = "dashed", color = "#155724", linewidth = 0.5) +
  geom_hline(yintercept = 50, linetype = "dashed", color = "#856404", linewidth = 0.5) +
  coord_flip() +
  scale_fill_manual(values = c("Green" = "#28a745", "Yellow" = "#ffc107",
                                "Red" = "#dc3545")) +
  scale_y_continuous(limits = c(0, 110)) +
  labs(
    title = paste0("Industry Context Scorecard (", CYCLE, ")"),
    subtitle = "Healthcare & Social Assistance sector health relative to total economy",
    x = NULL, y = "Score (0–100)"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none")
```

---

# 7 — Stored Outputs

All variables below are stored for modularity with downstream analysis files.

```{r stored-outputs}
# ── Stored variables ──
ind_t21_2024_vintage      <- VINTAGE
ind_t21_2024_cycle        <- CYCLE
ind_t21_2024_total_emp    <- total_emp_base
ind_t21_2024_total_proj   <- total_emp_proj
ind_t21_2024_total_pct    <- total_pct_proj
ind_t21_2024_total_cagr   <- total_cagr_proj
ind_t21_2024_hc_emp       <- hc_emp_base
ind_t21_2024_hc_proj      <- hc_emp_proj
ind_t21_2024_hc_pct       <- hc_pct_proj
ind_t21_2024_hc_cagr      <- hc_cagr_proj
ind_t21_2024_hc_share_base <- hc_pct_dist_base
ind_t21_2024_hc_share_proj <- hc_pct_dist_proj
ind_t21_2024_growth_ratio  <- growth_ratio
ind_t21_2024_scorecard     <- scorecard_df
ind_t21_2024_composite     <- composite_score
ind_t21_2024_signal        <- signal
ind_t21_2024_sectors       <- rankings
```

```{r output-registry}
output_registry <- tribble(
  ~variable,                        ~description,
  "ind_t21_2024_vintage",           "Projection vintage year (2024)",
  "ind_t21_2024_cycle",             "Projection cycle label (2024-2034)",
  "ind_t21_2024_total_emp",         "Total employment, base year (thousands)",
  "ind_t21_2024_total_proj",        "Total employment, projected (thousands)",
  "ind_t21_2024_total_pct",         "Total employment projected growth %",
  "ind_t21_2024_total_cagr",        "Total employment CAGR %",
  "ind_t21_2024_hc_emp",            "Healthcare & social assistance employment, base (thousands)",
  "ind_t21_2024_hc_proj",           "Healthcare & social assistance employment, projected (thousands)",
  "ind_t21_2024_hc_pct",            "Healthcare sector projected growth %",
  "ind_t21_2024_hc_cagr",           "Healthcare sector CAGR %",
  "ind_t21_2024_hc_share_base",     "Healthcare share of total employment, base year %",
  "ind_t21_2024_hc_share_proj",     "Healthcare share of total employment, projected %",
  "ind_t21_2024_growth_ratio",      "Healthcare growth / all-industry growth ratio",
  "ind_t21_2024_scorecard",         "Full scorecard dataframe (4 dimensions + composite)",
  "ind_t21_2024_composite",         "Composite scorecard score (0-100)",
  "ind_t21_2024_signal",            "Overall signal: Green/Yellow/Red",
  "ind_t21_2024_sectors",           "Full sector-level dataframe with rankings"
)

output_registry %>%
  kable(caption = "Output Variable Registry — industry_t21_2024.Rmd") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```
